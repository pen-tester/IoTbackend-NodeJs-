<!DOCTYPE html>
<html lang="en">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
    <!-- Meta, title, CSS, favicons, etc. -->
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">

    <title>{{floor.name}}</title>

    <!-- Bootstrap -->
    <link href="../vendors/bootstrap/dist/css/bootstrap.min.css" rel="stylesheet">
    <!-- Font Awesome -->
    <link href="../vendors/font-awesome/css/font-awesome.min.css" rel="stylesheet">
    <!-- NProgress -->
    <link href="../vendors/nprogress/nprogress.css" rel="stylesheet">
    <!-- iCheck -->
    <link href="../vendors/iCheck/skins/flat/green.css" rel="stylesheet">

    <!-- bootstrap-progressbar -->
    <link href="../vendors/bootstrap-progressbar/css/bootstrap-progressbar-3.3.4.min.css" rel="stylesheet">
    <!-- JQVMap -->
    <link href="../vendors/jqvmap/dist/jqvmap.min.css" rel="stylesheet"/>
    <!-- bootstrap-daterangepicker -->
    <link href="../vendors/bootstrap-daterangepicker/daterangepicker.css" rel="stylesheet">

    <!-- Custom Theme Style -->
    <link href="../build/css/custom.css" rel="stylesheet">
  </head>

  <body class="nav-md">
    <div class="container body">
      <div class="main_container">
        <div class="col-md-3 left_col">
          <div class="left_col scroll-view">
            <div class="navbar nav_title" style="border: 0;" text-align: center;>
              <a href="/" class="site_title"><img src="/images/logo-top-left.png" width="180px"/></a>
            </div>

            <div class="clearfix"></div>

            <br />

            <!-- sidebar menu -->
            <div id="sidebar-menu" class="main_menu_side hidden-print main_menu">
              <div class="menu_section">
                <ul class="nav side-menu">
                  <li class="active"><a href="/venue/ven0101"><i class="fa fa-sitemap"></i> Venue <span class="fa fa-chevron-down"></span></a>
                    <ul class="nav child_menu" style="display: block;">
                        <li class="active"><a href="/floor/floor_1/">Floor 1<span class="fa fa-chevron-down"></span></a>
                          <ul class="nav child_menu" style="display: block;">
                            <li><a href="/room/room_1_1W">Restroom 1-1W</a>
                            </li>
                            <li><a href="/room/room_1_1M">Restroom 1-1M</a>
                            </li>
                            <li><a href="/room/room_1_2W">Restroom 1-2W</a>
                            </li>
                            <li><a href="/room/room_1_2M">Restroom 1-2M</a>
                            </li>
                            <li><a href="/room/room_1_3W">Restroom 1-3W</a>
                            </li>
                            <li><a href="/room/room_1_3M">Restroom 1-3M</a>
                            </li>
                          </ul>
                        </li>
                        <li class="active"><a href="/floor_map/STA01">Floor 2<span class="fa fa-chevron-down"></span></a>
                          <ul class="nav child_menu" style="display: block;">
                            <li><a href="/room/room_2_1W">Restroom 2-1W</a>
                            </li>
                            <li><a href="/room/room_2_1M">Restroom 2-1M</a>
                            </li>
                            <li><a href="/room/room_2_2W">Restroom 2-2W</a>
                            </li>
                            <li><a href="/room/room_2_2M">Restroom 2-2M</a>
                            </li>
                            <li><a href="/room/room_2_3W">Restroom 2-3W</a>
                            </li>
                            <li><a href="/room/room_2_3M">Restroom 2-3M</a>
                            </li>
                          </ul>
                        </li>
                        <li class="active"><a href="/floor/floor_3/">Floor 3<span class="fa fa-chevron-down"></span></a>
                          <ul class="nav child_menu" style="display: block;">
                            <li><a href="/room/room_3_1W">Restroom 3-1W</a>
                            </li>
                            <li><a href="/room/room_3_1M">Restroom 3-1M</a>
                            </li>
                            <li><a href="/room/room_3_2W">Restroom 3-2W</a>
                            </li>
                            <li><a href="/room/room_3_2M">Restroom 3-2M</a>
                            </li>
                            <li><a href="/room/room_3_3W">Restroom 3-3W</a>
                            </li>
                            <li><a href="/room/room_3_3M">Restroom 3-3M</a>
                            </li>
                          </ul>
                        </li>
                    </ul>
                  </li>
                </ul>
              </div>

            </div>
            <!-- /sidebar menu -->

            <!-- /menu footer buttons -->
            <div class="sidebar-footer hidden-small">
              <a href="/venue/{{venueid}}/setting" data-toggle="tooltip" data-placement="top" title="Settings">
                <span class="glyphicon glyphicon-cog" aria-hidden="true"></span>
              </a>
              <a data-toggle="tooltip" data-placement="top" title="FullScreen">
                <span class="glyphicon glyphicon-fullscreen" aria-hidden="true"></span>
              </a>
              <a data-toggle="tooltip" data-placement="top" title="Lock">
                <span class="glyphicon glyphicon-eye-close" aria-hidden="true"></span>
              </a>
              <a data-toggle="tooltip" data-placement="top" title="Logout" href="login">
                <span class="glyphicon glyphicon-off" aria-hidden="true"></span>
              </a>
            </div>
            <!-- /menu footer buttons -->
          </div>
        </div>

        <!-- top navigation -->
        <div class="top_nav">
          <div class="nav_menu">
            <nav>
              <div class="nav toggle">
                <a id="menu_toggle"><i class="fa fa-bars"></i></a>
              </div>
              <div class="nav top_title">
                <img src="/images/logo-top-center.png" width="200px"/>
              </div>

              <ul class="nav navbar-nav navbar-right">
                <li class="">
                  <a href="javascript:;" class="user-profile dropdown-toggle" data-toggle="dropdown" aria-expanded="false">
                    Michael S.
                    <span class=" fa fa-angle-down"></span>
                  </a>
                  <ul class="dropdown-menu dropdown-usermenu pull-right">
                    <li><a href="javascript:;"> Profile</a></li>
                    <li>
                      <a href="javascript:;">
                        <span class="badge bg-red pull-right">50%</span>
                        <span>Settings</span>
                      </a>
                    </li>
                    <li><a href="javascript:;">Help</a></li>
                    <li><a href="logout"><i class="fa fa-sign-out pull-right"></i> Log Out</a></li>
                  </ul>
                </li>

                <li role="presentation" class="dropdown">
                  <a href="javascript:;" class="dropdown-toggle info-number" data-toggle="dropdown" aria-expanded="false">
                    <i class="fa fa-envelope-o"></i>
                    <span class="badge bg-green">6</span>
                  </a>
                  <ul id="menu1" class="dropdown-menu list-unstyled msg_list" role="menu">
                    <li>
                      <a>
                        <span class="image"><img src="../images/img.jpg" alt="Profile Image" /></span>
                        <span>
                          <span>Modus Team</span>
                          <span class="time">3 mins ago</span>
                        </span>
                        <span class="message">
                          Threshold Hit!  Floor 2 Room 4W hit your...
                        </span>
                      </a>
                    </li>
                    <li>
                      <a>
                        <span class="image"><img src="../images/img.jpg" alt="Profile Image" /></span>
                        <span>
                          <span>Modus Team</span>
                          <span class="time">15 mins ago</span>
                        </span>
                        <span class="message">
                          Threshold Hit!  Floor 1 Room 2M hit your...
                        </span>
                      </a>
                    </li>
                    <li>
                      <a>
                        <span class="image"><img src="../images/img.jpg" alt="Profile Image" /></span>
                        <span>
                          <span>Modus Team</span>
                          <span class="time">22 mins ago</span>
                        </span>
                        <span class="message">
                          Maitainance Needed on Floor 3 Room 1W ...
                        </span>
                      </a>
                    </li>
                    <li>
                      <a>
                        <span class="image"><img src="../images/img.jpg" alt="Profile Image" /></span>
                        <span>
                          <span>Modus Team</span>
                          <span class="time">55 mins ago</span>
                        </span>
                        <span class="message">
                          Replace Batteries on Floor 1 Room 3W...
                        </span>
                      </a>
                    </li>
                    <li>
                      <div class="text-center">
                        <a>
                          <strong>See All Alerts</strong>
                          <i class="fa fa-angle-right"></i>
                        </a>
                      </div>
                    </li>
                  </ul>
                </li>
              </ul>
            </nav>
          </div>

        </div>
        <!-- /top navigation -->

        <!-- page content -->
        <div class="right_col" role="main">
          <!-- top tiles -->
          <div class="row tile_count">
            <div class="col-md-4 col-sm-4 col-xs-6 tile_stats_count">
              <span class="count_top"><i class="fa fa-user"></i> Available Stalls</span>
              <div class="count" style="font-size:40px;">
              <span style="color:rgb(131,253,64); font-size:40px;font-weight: bolder;" id="available_stalls">{{floor.available_stalls}}</span>
              <span class="small_content" id="room_stalls_stat">
              of 144 (<span id="available_percent">{{floor.available_percent}}</span>%)
              </span>
              </div>
              <span class="count_bottom" style="color:#A1A1A1; font-style: italic;">
                  <i class="green" style="color:rgb(131,253,64);">
                  <span id="available_fromlastweek">{{floor.available_fromlastweek}}</span>% </i> From last Week
              </span>
            </div>
            <div class="col-md-4 col-sm-4 col-xs-6 tile_stats_count">
              <span class="count_top"><i class="fa fa-clock-o"></i> Total Usage Today</span>
              <div class="count"><span id="avg_vacant_time" style="font-size:40px;">{{floor.avg_vacant_time}}</span> mins</div>
              <span class="count_bottom" style="color:#A1A1A1;font-style: italic;">
                <i class="red"><span id="vacant_time_percent">{{floor.vacant_time_percent}}</span>% </i> From last Week
              </span>
            </div>
            <div class="col-md-4 col-sm-4 col-xs-6 tile_stats_count red">
              <span class="count_top" style="color:rgb(231, 89, 88);">Needs Attention</span>
              <div class="needs_attention_icon">
                <div class="count" id="needs_attention">3</div>
                <img src="/images/maintanence.png" width="40px"></img>
                <img src="/images/battery.png" width="40px"></img>
              </div>
              <span class="count_bottom"></span>
            </div>

          </div>
          <!-- /top tiles -->

          <div class="row">
            <div class="col-md-12 col-sm-12 col-xs-12">
              <div class="dashboard_graph">

                <div class="row x_title">
                  <div class="col-md-6">
                    <h3 id="floor_name">{{floor.name}}</h3>
                  </div>
                  <div class="col-md-6">
                    <div id="reportrange" class="pull-right" style="background: #fff; cursor: pointer; padding: 5px 10px; border: 1px solid #ccc">
                      <i class="glyphicon glyphicon-calendar fa fa-calendar"></i>
                      <span>December 30, 2014 - January 28, 2015</span> <b class="caret"></b>
                    </div>
                  </div>
                </div>

                <div class="col-md-9 col-sm-9 col-xs-12" style="text-align: center;width: 100%;">
                    <div class="show_devinfo" style="height:180px;">
                        <div style="font-size: 32px;">Restroom <span id="show_stallno"></span></div>
                        <div>&#x25CF; used <span id="show_used_today"></span> today</div>
                        <div>&#x25CF; used <span id="show_used_week"></span> this week</div>
                        <div style="font-size: 20px; line-height:30px">status:&nbsp;&nbsp;
                            <svg height="25" width="22" style="vertical-align: sub;">
                                <circle cx="12" cy="15" r="10" stroke="black" stroke-width="1" fill="red" id="show_dev_status" />
                            </svg> <span id="dev_status_text">available</span></div>
                        <div style="font-size: 20px; line-height:30px">battery:&nbsp;
                            <svg height="25" width="22" style="vertical-align: sub;">
                               <circle cx="12" cy="15" r="10" stroke="black" stroke-width="1" fill="red"  id="show_dev_battery"/>
                           </svg> charged</div>
                        <!--<div class="popup_btn_row">
                           <img id="flash_button" src="/images/pop-over-button1.png" width="60px"></img>
                           <img src="/images/pop-over-button2.png" width="60px"></img>
                           <a href="https://www.youtube.com/watch?v=ok1AcpoooCw" target="_blank"><img src="/images/pop-over-button2.png" width="60px"></img></a>
                        </div>-->
                    </div>
                    <div class="stadium_device_list">
                        {{#each rooms}}
                            <div class="device pos_{{id}}" id="{{name}}" data-id="{{room_id}}">
                                <div class="dev_status"
                                    style="color: {{status_col}};background-color: {{status_col}};border-color: {{status_col}}; box-shadow: 1px 1px 5px 3px #bbbcbc;">
                                    {{id}}
                                </div>
                            </div>
                        {{/each}}
                    </div>
                </div>

                <div class="clearfix"></div>
              </div>
            </div>

          </div>
          <br />

          <div class="row">

            <div class="col-md-4 col-sm-4 col-xs-12">
              <div class="x_panel tile fixed_height_320">
                <div class="x_title">
                  <h2>Occupied Meter</h2>
                  <ul class="nav navbar-right panel_toolbox">
                    <li><a class="collapse-link"><i class="fa fa-chevron-up"></i></a>
                    </li>
                    <li class="dropdown">
                      <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false"><i class="fa fa-wrench"></i></a>
                      <ul class="dropdown-menu" role="menu">
                        <li><a href="#">Settings 1</a>
                        </li>
                        <li><a href="#">Settings 2</a>
                        </li>
                      </ul>
                    </li>
                    <li><a class="close-link"><i class="fa fa-close"></i></a>
                    </li>
                  </ul>
                  <div class="clearfix"></div>
                </div>
                <div class="x_content">
                  <div class="dashboard-widget-content">
                    <div class="sidebar-widget" style="padding:20px 0px; margin-left: calc(50% - 80px);">
                        <canvas width="150" height="80" id="chart_gauge_01" class="" style="width: 160px; height: 100px;"></canvas>
                        <div class="goal-wrapper">
                          <span id="gauge-text" class="gauge-value pull-left">0</span>
                          <span class="gauge-value pull-left">%</span>
                          <span id="goal-text" class="goal-value pull-right">100%</span>
                        </div>
                    </div>
                    <div class="usage_meter">
                            {{usage_meter}}
                    </div>
                  </div>
                </div>
              </div>
            </div>

            <div class="col-md-8 col-sm-8 col-xs-12">
              <div class="x_panel tile fixed_height_320">
                <div class="x_title">
                  <div class="clearfix"></div>
                </div>
                <div class="x_content">
                  <div class="col-md-12 col-sm-12 col-xs-12">
                    <div id="chart_plot_01" class="demo-placeholder"></div>
                    <div class="graph_title">
                    <span>
                        <i class="fa fa-square" style="color:rgb(197, 249, 164)"></i>
                        Activity Today
                    </span>
                    <span>
                        <i class="fa fa-square" style="color:rgb(151,211,157)""></i>
                        Daily Average
                    </span>
                    </div>
                  </div>
                </div>
              </div>
            </div>


          </div>


          <div class="row">
            <div class="col-md-12 col-sm-12 col-xs-12">
                <div class="x_panel">
                  <div class="x_title">
                    <h2>Table View</h2>
                    <ul class="nav navbar-right panel_toolbox">
                      <li><a class="collapse-link"><i class="fa fa-chevron-up"></i></a>
                      </li>
                      <li class="dropdown">
                        <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false"><i class="fa fa-wrench"></i></a>
                        <ul class="dropdown-menu" role="menu">
                          <li><a href="#">Settings 1</a>
                          </li>
                          <li><a href="#">Settings 2</a>
                          </li>
                        </ul>
                      </li>
                      <li><a class="close-link"><i class="fa fa-close"></i></a>
                      </li>
                    </ul>
                    <div class="clearfix"></div>
                  </div>
                  <div class="x_content" style="text-align: center">
                    <div class="x_table_container">
                        <table id="datatable" class="table table-striped table-bordered">
                          <thead>
                            <tr>
                              <th>Room #</th>
                              <th>Day</th>
                              <th>Week</th>
                              <th>Month</th>
                              <th>Avg. Time Occupied</th>
                              <th>Avg. Time Available</th>
                              <th>Longest Use</th>
                            </tr>
                          </thead>

                          <tbody>
                            {{#each allrooms}}
                            <tr>
                              <td>{{floor}} {{_id}}</td>
                              <td>{{used_today}}</td>
                              <td>{{used_week}}</td>
                              <td>{{used_month}}</td>
                              <td>{{avg_vacant_time}}</td>
                              <td>{{avg_busy_time}}</td>
                              <td>{{long_use}}</td>
                            </tr>
                            {{/each}}
                          </tbody>
                        </table>
                    </div>
                  </div>
                </div>
            </div>
          </div>
        </div>
        <!-- /page content -->

        <!-- footer content -->
        <footer>
          <div class="pull-right">
            Copyright 2017 Modus Systems, Inc.
          </div>
          <div class="clearfix"></div>
        </footer>
        <!-- /footer content -->
      </div>
    </div>

    <!-- jQuery -->
    <script src="../vendors/jquery/dist/jquery.min.js"></script>
    <!-- Bootstrap -->
    <script src="../vendors/bootstrap/dist/js/bootstrap.min.js"></script>
    <!-- FastClick -->
    <script src="../vendors/fastclick/lib/fastclick.js"></script>
    <!-- NProgress -->
    <script src="../vendors/nprogress/nprogress.js"></script>
    <!-- Chart.js -->
    <script src="../vendors/Chart.js/dist/Chart.min.js"></script>
    <!-- gauge.js -->
    <script src="../vendors/gauge.js/dist/gauge.js"></script>
    <!-- bootstrap-progressbar -->
    <script src="../vendors/bootstrap-progressbar/bootstrap-progressbar.min.js"></script>
    <!-- iCheck -->
    <script src="../vendors/iCheck/icheck.min.js"></script>
    <!-- Skycons -->
    <script src="../vendors/skycons/skycons.js"></script>
    <!-- Flot -->
    <script src="../vendors/Flot/jquery.flot.js"></script>
    <script src="../vendors/Flot/jquery.flot.pie.js"></script>
    <script src="../vendors/Flot/jquery.flot.time.js"></script>
    <script src="../vendors/Flot/jquery.flot.stack.js"></script>
    <script src="../vendors/Flot/jquery.flot.resize.js"></script>
    <!-- Flot plugins -->
    <script src="../vendors/flot.orderbars/js/jquery.flot.orderBars.js"></script>
    <script src="../vendors/flot-spline/js/jquery.flot.spline.min.js"></script>
    <script src="../vendors/flot.curvedlines/curvedLines.js"></script>
    <!-- DateJS -->
    <script src="../vendors/DateJS/build/date.js"></script>
    <!-- JQVMap -->
    <script src="../vendors/jqvmap/dist/jquery.vmap.js"></script>
    <script src="../vendors/jqvmap/dist/maps/jquery.vmap.world.js"></script>
    <script src="../vendors/jqvmap/examples/js/jquery.vmap.sampledata.js"></script>
    <!-- bootstrap-daterangepicker -->
    <script src="../vendors/moment/min/moment.min.js"></script>
    <script src="../vendors/bootstrap-daterangepicker/daterangepicker.js"></script>

    <!-- Custom Theme Scripts -->
    <script src="/js/socket.io.min.js"></script>
    <script src="/js/animateNumber.min.js"></script>
    <script src="../build/js/floor_map.js"></script>
    <script>
        var room_id = '{{floor.room_id}}';
        var dev_infos =[];
        var selected_dev = {};
        {{#each rooms}}
        dev_infos['{{name}}'] = {id:{{id}}, dayuses: '{{used_today}}', weekuses: '{{used_week}}', status: '{{status}}', battery: '{{battery}}', room_id: '{{room_id}}' };
        {{/each}}
        /*dev_infos['dev1'] = {id:1, dayuses: 11, weekuses: 66, status: 'vacant', battery: 'charged'};
        dev_infos['dev2'] = {id:2, dayuses: 122, weekuses: 66, status: 'no', battery: 'no'};
        dev_infos['dev3'] = {id:3, dayuses: 2, weekuses: 66, status: 'vacant', battery: 'charged'};
        dev_infos['dev4'] = {id:4, dayuses: 18, weekuses: 66, status: 'vacant', battery: 'charged'};
        dev_infos['dev5'] = {id:5, dayuses: 3, weekuses: 66, status: 'vacant', battery: 'no'};
        dev_infos['dev6'] = {id:6, dayuses: 50, weekuses: 60, status: 'vacant', battery: 'no'};
        dev_infos['dev7'] = {id:7, dayuses: 2, weekuses: 26, status: 'vacant', battery: 'charged'};
        dev_infos['dev8'] = {id:8, dayuses: 3, weekuses: 66, status: 'no', battery: 'charged'};
        dev_infos['dev9'] = {id:9, dayuses: 36, weekuses: 91, status: 'vacant', battery: 'charged'};
        dev_infos['dev10'] = {id:10, dayuses: 20, weekuses: 66, status: 'vacant', battery: 'charged'};*/
        /*$(document).mousemove( function(e) {
            if ($('.show_devinfo').is(":visible")) {
                 var parentOffset = $(e.target).parent().offset()
                 var relX = e.pageX - parentOffset.left + 10;
                 var relY = e.pageY - parentOffset.top + 10;
                 $('.show_devinfo').css({'top':relY,'left':relX});
            }
        });*/
        $('.device').click(function(e){
            selected_dev = dev_infos[$(e.target).parent(".device").attr('id')];
            if (!selected_dev) {
                selected_dev = dev_infos[$(e.target).attr('id')];
            }
            //console.log(selected_dev);
            if (!selected_dev)
                selected_dev = {};
            if (selected_dev) {
                $('#show_stallno').html(selected_dev.id);
                $('#show_used_today').html(selected_dev.dayuses+' times');
                $('#show_used_week').html(selected_dev.weekuses+' times');
                if (selected_dev.status == 'vacant') {
                    $('#show_dev_status').attr("fill", "#78ff3b");
                    $('#dev_status_text').html("vacant");
                } else {
                    $('#show_dev_status').attr("fill", "red");
                    $('#dev_status_text').html("full");
                }
                if (selected_dev.battery== 'charged') {
                    $('#show_dev_battery').attr("fill", "#78ff3b");
                } else {
                    $('#show_dev_battery').attr("fill", "red");
                }
            }
            var parentOffset = $(this).parent(".stadium_device_list").parent().offset();
            var relX = e.pageX - parentOffset.left;
            var relY = e.pageY - parentOffset.top;
            $('.show_devinfo').css({'top':relY,'left':relX});
            $('.show_devinfo').toggle();
        });
        /*
        $('.device').mouseout(function(evt){
            $('.show_devinfo').css({display:'none'});
        });*/
        var socket = io.connect(window.location.origin); // connect to server
        var socket2 = io.connect(window.location.protocol+'//'+window.location.hostname+':5001'); // connect to server
        $('#flash_button').click(function(evt){
            socket2.emit('flash');
        });
        socket.on('room_updated', function (room_ent) { // listen to connection acknowledgement
            console.log (room_ent);
            var room_div = $('[data-id=' + room_ent.room_id + ']');
            if (room_div){
                room_div.children(".dev_status").css("border-color", "rgb(255*(room_ent.total_stalls - room_ent.available_stalls)/room_ent.total_stalls, \
                            255*room_ent.available_stalls/room_ent.total_stalls ,0 )");
                room_div.children(".dev_status").css("background-color", "rgb(255*(room_ent.total_stalls - room_ent.available_stalls)/room_ent.total_stalls, \
                            255*room_ent.available_stalls/room_ent.total_stalls ,0 )");
                room_div.children(".dev_status").css("color", "rgb(255*(room_ent.total_stalls - room_ent.available_stalls)/room_ent.total_stalls, \
                            255*room_ent.available_stalls/room_ent.total_stalls ,0 )");
                                
                dev_infos[room_ent.name] = {id:room_ent.id, dayuses: room_ent.used_today, weekuses: room_ent.used_week,
                    status: room_ent.status, battery: room_ent.battery, room_id: room_ent.room_id};
                console.log (selected_dev);
                if (selected_dev.room_id == room_ent.room_id) {
                    selected_dev = dev_infos[room_ent.name];
                    $('#show_stallno').html(selected_dev.id);
                    $('#show_used_today').html(selected_dev.dayuses+' times');
                    $('#show_used_week').html(selected_dev.weekuses+' times');
                    if (selected_dev.status == 'vacant') {
                        $('#show_dev_status').attr("fill", "rgb(129,239,144)");
                    } else {
                        $('#show_dev_status').attr("fill", "red");
                    }
                    if (selected_dev.battery== 'charged') {
                        $('#show_dev_battery').attr("fill", "rgb(129,239,144)");
                    } else {
                        $('#show_dev_battery').attr("fill", "red");
                    }
                }
            }
            //location.reload();
            socket.emit('accepted_room_event', room_ent); // accept received event from the server
        });
        socket.on('floor_updated', function (floor_ent) { // listen to connection acknowledgement
            console.log (floor_ent);
            if (room_id == floor_ent.room_id) {
                $('#floor_name').html(floor_ent.name);
                $('#available_stalls').html(floor_ent.available_stalls);
                $('#room_stalls_stat').html('of '+floor_ent.total_stalls+' (<span id="available_percent">'+floor_ent.available_percent+'</span>%)');
                $('#available_fromlastweek').html(floor_ent.available_fromlastweek);
                $('#avg_vacant_time').html(floor_ent.avg_vacant_time);
                $('#vacant_time_percent').html(floor_ent.vacant_time_percent);
                $('#needs_attention').html(floor_ent.needs_attention);
                $('#available_percent').animateNumber({ number: floor_ent.available_percent });
                $('#avg_vacant_time').animateNumber({ number: floor_ent.avg_vacant_time });
                $('#needs_attention').animateNumber({ number: floor_ent.needs_attention });
                set_usage_meter ((100-floor_ent.available_percent)*100);
            }
            socket.emit('accepted_floor_event', floor_ent); // accept received event from the server
        });
        $('#available_percent').animateNumber({ number: {{floor.available_percent}} });
        $('#avg_vacant_time').animateNumber({ number: {{floor.avg_vacant_time}} });
        $('#needs_attention').animateNumber({ number: {{floor.needs_attention}} });
    </script>
  </body>
</html>
